# IP 地址检测 (IpAddress)

## 概述

IP 地址检测能够识别 IPv4 和 IPv6 网络地址格式，支持各种标准的 IP 地址表示方法。

- **内容子类型**: `IpAddress`
- **检测优先级**: 高（第二优先级）
- **返回元数据**: 无

## 检测逻辑

IP 地址检测分为 IPv4 和 IPv6 两种格式的检测：

### IPv4 检测

使用正则表达式验证标准的 IPv4 格式：

```rust
let ipv4_regex = Regex::new(
    r"^(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$"
).unwrap();
```

### IPv6 检测

使用复杂的正则表达式验证各种 IPv6 格式：

```rust
let ipv6_regex = Regex::new(
    r"^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|...)"
).unwrap();
```

## 能识别的内容

### ✅ IPv4 地址

基于测试用例，以下 IPv4 格式会被正确识别：

#### 标准 IPv4 地址

```text
192.168.1.1      # 私网地址
127.0.0.1        # 本地回环地址
255.255.255.255  # 广播地址
0.0.0.0          # 全零地址
8.8.8.8          # 公网 DNS 地址
10.0.0.1         # 私网地址
```

#### 地址范围

- 每个段的数值范围：0-255
- 支持 0 开头的地址（如 `001.002.003.004`）
- 支持单双数字段（如 `1.2.3.4`）

### ✅ IPv6 地址

支持各种 IPv6 格式：

#### 完整格式

```text
2001:0db8:85a3:0000:0000:8a2e:0370:7334
```

#### 压缩格式

```text
2001:db8:85a3::8a2e:370:7334    # 零压缩
::1                              # 本地回环（压缩形式）
fe80::1%lo0                      # 带接口标识符
```

#### 特殊地址

```text
::                    # 全零地址
::1                   # IPv6 回环地址
fe80::                # 链路本地地址前缀
```

### ❌ 无效示例

以下格式不会被识别为 IP 地址：

```text
256.256.256.256      # IPv4 段超出范围 (0-255)
192.168.1            # IPv4 段数不足
192.168.1.1.1        # IPv4 段数过多
not.an.ip.address    # 非数字内容
300.1.1.1            # 第一段超出范围
1.2.3                # 缺少段
```

## 解析出的内容

IP 地址检测不提供额外的元数据解析，返回的元数据为空：

```rust
ContentMetadata {
    detected_language: None,
    url_parts: None,
    color_formats: None,
    timestamp_formats: None,
    base64_metadata: None,
}
```

IP 地址的值本身已经是标准化的网络地址格式，不需要进一步的结构化解析。

## 测试用例

### IPv4 地址测试

```rust
#[test]
fn test_ipv4_detection() {
    let valid_ipv4 = vec![
        "192.168.1.1",
        "127.0.0.1",
        "255.255.255.255",
        "0.0.0.0",
        "8.8.8.8",
        "10.0.0.1",
    ];

    for ip in valid_ipv4 {
        let (sub_type, _) = ContentDetector::detect(ip);
        assert_eq!(sub_type, ContentSubType::IpAddress);
    }
}
```

### IPv6 地址测试

```rust
#[test]
fn test_ipv6_detection() {
    let valid_ipv6 = vec![
        "2001:0db8:85a3:0000:0000:8a2e:0370:7334",
        "2001:db8:85a3::8a2e:370:7334",
        "::1",
        "fe80::1%lo0",
    ];

    for ip in valid_ipv6 {
        let (sub_type, _) = ContentDetector::detect(ip);
        assert_eq!(sub_type, ContentSubType::IpAddress);
    }
}
```

### 无效 IP 地址测试

```rust
#[test]
fn test_invalid_ip_addresses() {
    let invalid_ips = vec![
        "256.256.256.256",    // 数值超出范围
        "192.168.1",          // 段数不足
        "192.168.1.1.1",      // 段数过多
        "not.an.ip.address",  // 非数字内容
    ];

    for ip in invalid_ips {
        let (sub_type, _) = ContentDetector::detect(ip);
        assert_ne!(sub_type, ContentSubType::IpAddress);
    }
}
```

## 使用场景

IP 地址检测主要用于：

1. **网络配置**: 识别和验证网络配置中的 IP 地址
2. **日志分析**: 从系统日志中提取 IP 地址信息
3. **网络诊断**: 快速识别网络相关的 IP 信息
4. **安全审计**: 识别访问日志中的 IP 地址
5. **网络工具**: 为 IP 地址提供 ping、traceroute 等功能

## 地址类型识别

虽然不提供结构化元数据，但可以根据 IP 地址的范围判断其类型：

### IPv4 地址分类

- **私网地址**: `10.0.0.0/8`, `172.16.0.0/12`, `192.168.0.0/16`
- **回环地址**: `127.0.0.0/8`
- **链路本地**: `169.254.0.0/16`
- **组播地址**: `224.0.0.0/4`
- **公网地址**: 其他范围

### IPv6 地址分类

- **回环地址**: `::1`
- **链路本地**: `fe80::/10`
- **唯一本地**: `fc00::/7`
- **全局单播**: `2000::/3`

## 注意事项

1. **严格验证**: 使用精确的正则表达式，确保地址格式的正确性
2. **范围检查**: IPv4 地址的每个段必须在 0-255 范围内
3. **格式支持**: 支持各种标准的 IPv6 表示方法，包括零压缩
4. **接口标识**: IPv6 地址支持接口标识符（如 `%lo0`）
5. **无元数据**: 不进行额外的解析，保持原始地址格式

## 性能特点

- **检测速度**: 快（正则表达式匹配）
- **内存使用**: 低（无元数据存储）
- **验证准确性**: 高（严格的格式验证）
- **支持范围**: 全面（IPv4 和 IPv6 的各种格式）
