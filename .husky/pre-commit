#!/bin/sh

# Run lint-staged for JavaScript/TypeScript files
pnpm exec lint-staged

# Check if there are any Rust files staged
if git diff --cached --name-only | grep -q "\.rs$"; then
  echo "Running Rust formatting and linting..."
  
  # Run cargo fmt to automatically format Rust files
  cd src-tauri
  cargo fmt
  if [ $? -ne 0 ]; then
    echo "❌ Rust formatting failed."
    cd ..
    exit 1
  fi
  
  # Run cargo clippy
  cargo clippy -- -D warnings
  if [ $? -ne 0 ]; then
    echo "❌ Rust clippy check failed. Please fix the warnings."
    cd ..
    exit 1
  fi
  
  cd ..
  
  # Add any formatted files back to the staging area
  git add src-tauri/src/
  echo "✅ Rust checks passed!"
fi
